<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Adding New Clients - Legal-10 Benchmark</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link href="../docstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Adding New Clients";
        var mkdocs_page_input_path = "developer_adding_new_models.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Legal-10 Benchmark
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Legal-10 Benchmark</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../notes/">Legal-10 Development Notes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../quick_start/">Quick Start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorial/">Tutorial</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../run_entries_configuration_files/">Run Entries Configuration Files</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../run_entries/">Run Entries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../credentials/">Credentials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../importing_custom_modules/">Importing Custom Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_models/">Adding New Models</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_scenarios/">Adding New Scenarios</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adding_new_tokenizers/">Adding New Tokenizers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../benchmark/">Advanced Benchmarking Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../huggingface_models/">Hugging Face Model Hub Integration</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../models/">Models</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../metrics/">Metrics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../perturbations/">Perturbations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenarios/">Scenarios</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../schemas/">Schemas</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../developer_setup/">Developer Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code/">Code Structure</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Adding New Clients</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview-of-the-process">Overview of the process</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#where-to-create-the-objects">Where to create the objects</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example">Example</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../proxy_server/">Proxy Server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../editing_documentation/">Editing Documentation</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Legal-10 Benchmark</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Developer Guide</li>
      <li class="breadcrumb-item active">Adding New Clients</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/prophetto1/legal-10-benchmark/blob/main/docs/developer_adding_new_models.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="adding-new-clients">Adding New Clients</h1>
<p><strong>Warning</strong> &mdash; The document is stale. The information below may be outdated and incorrect. Please proceed with caution!</p>
<h2 id="overview-of-the-process">Overview of the process</h2>
<p>To add a new model you need to define 3 objects:
* a <code>ModelMetadata</code> objects that defines properties of your model (name, metadata, capabilities, ...).
* one or several <code>ModelDeployment</code> which defines how to query a model (mainly by providing a <code>Client</code>, a <code>WindowService</code> and a <code>Tokenizer</code>). You can define several deployments for a single model (<code>local/your-model</code>, <code>huggingface/your-model</code>, <code>together/your-model</code>, ...).
* a <code>TokenizerConfig</code> which defines how to build the <code>Tokenizer</code> (mainly by providing a <code>TokenizerSpec</code>).</p>
<p>In some cases you might have to define additionally:
* a <code>Client</code> if your query method differ from any clients we have implemented. This will be then referenced in the <code>ModelDeployment</code>. We recommend checking <code>HTTPModelClient</code> and <code>HuggingFaceClient</code> which can be used in a lot of cases. If you identify the need for a new client, a good starting to point is to have a look at <code>SimpleClient</code>.
* a <code>WindowService</code>. First have a look at <code>DefaultWindowService</code> to check if this is not enough for your use case. If you need you own <code>truncate_from_right</code> function, then you might need to create your own <code>WindowService</code>. In that case, a good starting point is to have a look at <code>YaLMWindowService</code>.</p>
<h2 id="where-to-create-the-objects">Where to create the objects</h2>
<p>There are two cases: private models that should only be accessible to you and models not yet supported by HELM but that would benefit everyone if added.</p>
<p>In the first case, you should create the files <code>model_deployments.yaml</code>, <code>model_metadata.yaml</code> and <code>tokenizer_configs.yaml</code> in <code>prod_env/</code> (A folder that you should create at the root of the repo if not already done). HELM will automatically registed any model defined in these files without any change in the code while ignoring them on Github which can be convenient for you. Then you can simply duplicate the corresponding files from <code>src/helm/config</code>, delete the models and add yours. Follow the next section for an example.</p>
<p>In the second case, if you want to add a model to HELM, you can directly do it in <code>src/helm/config</code>. You can then open a Pull Request on Github to share the model. When you do, make sure to:
* Include any link justifying the metadata used in <code>ModelMetadata</code> such as the release data, number of parameters, capabilities and so on (you should not infer anything).
* Check that you are respecting the format used in those files (<code>ModelMetadata</code> should be named as <code>&lt;CREATOR-ORGANIZATION&gt;/&lt;MODEL-NAME&gt;</code> and the <code>ModelDeployment</code> should be named as <code>&lt;HOST-ORGANIZATION&gt;/&lt;MODEL-NAME&gt;</code>, for example <code>ModelMetadata</code>: <code>openai/gpt2</code> and <code>ModelDeployment</code>: <code>huggingface/gpt2</code>). Add the appropriate comments and so on.
* Run <code>helm-run --run-entries "mmlu:subject=anatomy,model_deployment=&lt;YOUR-DEPLOYMENT&gt;" --suite v1 --max-eval-instances 10</code> and make sure that everything works. Include the logs from the terminal in your PR.
* Not create unnecessary objects (<code>Client</code> <code>TokenizerCOnfig</code>, <code>WindowService</code>) and if you have to create one of these objects, document in your PR why you had to. Make them general enough so that they could be re-used by other models (especially the <code>Client</code>).</p>
<h2 id="example">Example</h2>
<p>In <code>src/helm/config/model_metadata.yaml</code>:</p>
<pre><code class="language-yaml"># [...]

models:

  - name: simple/model1
    [...]

  # NEW MODEL STARTS HERE
  - name: simple/tutorial
    display_name: Tutorial Model
    description: This is a simple model used in the tutorial.
    creator_organization_name: Helm
    access: open
    release_date: 2023-01-01
    tags: [TEXT_MODEL_TAG, FULL_FUNCTIONALITY_TEXT_MODEL_TAG]

  [...]
</code></pre>
<p>In <code>src/helm/config/model_deployments.yaml</code>:</p>
<pre><code class="language-yaml"># [...]

model_deployments:

  - name: simple/model1
    [...]

  - name: simple/tutorial
    model_name: simple/tutorial
    tokenizer_name: simple/model1
    max_sequence_length: 2048
    client_spec:
      class_name: &quot;helm.clients.simple_client.SimpleClient&quot;
      args: {}
    window_service_spec:
      class_name: &quot;helm.benchmark.window_services.openai_window_service.OpenAIWindowService&quot;
      args: {}

  [...]
</code></pre>
<p>We won't be adding any <code>TokenizerConfig</code> here as we are reusing <code>simple/model1</code>. This shows a good practice when adding a new model, always check if the correct tokenizer does not already exists.</p>
<p>You should now be able to run <code>helm-run --run-entries "mmlu:subject=anatomy,model_deployment=simple/tutorial" --suite v1 --max-eval-instances 10</code> without any error.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../code/" class="btn btn-neutral float-left" title="Code Structure"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../proxy_server/" class="btn btn-neutral float-right" title="Proxy Server">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/prophetto1/legal-10-benchmark/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../code/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../proxy_server/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
